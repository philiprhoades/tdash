$.fn.setCursorPosition=function(a){this.each(function(c,d){if(d.setSelectionRange){d.setSelectionRange(a,a)}else{if(d.createTextRange){var b=d.createTextRange();b.collapse(true);b.moveEnd("character",a);b.moveStart("character",a);b.select()}}});return this};function createMyNotification(c,a){var b=null;if(window.webkitNotifications){if(window.webkitNotifications.checkPermission()==0){notifier=window.webkitNotifications.createNotification("/images/logoColor57x57.png",c,a);notifier.show()}}return notifier}var showMore=false;function toggleMoreFriends(){$("#moreFrndContent").toggle();var a=($("#moreButt").text()=="Less")?"More":"Less";$("#moreButt").text(a);showMore=!showMore}function changeCSS(a){$("#cssLink").attr("href",a)}function getCurrTime(){return(new Date()).getTime()}var currLogin=-1,readerObj=null;var rQ=new function(){var b=[],f=0,g=0,e=0;this.nQ=function(l,k,n,j,m,h,o){b.push([n,j,m,h,o,getCurrTime(),l,k]);d();if(f==0){c()}};function d(){if(b.length>0){$("#fetchCount").text("Pending requests: "+b.length)}else{$("#fetchCount").text("");$("#flattrDiv").show();dash.fetchOver()}}function a(h){$("#fetchStatus").text((h.length>0)?"Fetching "+h:h)}function c(){var j=b.shift(),h=getCurrTime();var k=(h-e)<120000?15*60000:5*60000;if(((!j[7])&&(currLogin>=0)&&(j[6]!=currLogin))||((getCurrTime()-j[5])>k)){a("");d();if(b.length>0){c()}}else{f+=1;g=getCurrTime();a(j[0]);dashOauth.oauthGetJSONP(j[1],j[2],oauthAccessor[j[6]],j[3],function(l,m){e=getCurrTime();j[4](l,m);f-=1;a("");d();if(b.length>0){c()}})}}this.selfCheck=function(){var h=getCurrTime()-g;if((b.length>0)&&(f>0)){if(h>30000){c()}else{if(h>15000){a("Will retry in "+(30-Math.round(h/1000))+" seconds")}}}setTimeout("rQ.selfCheck();",2000)};this.selfCheck()};var dash=new function(){var aL="5.49",p="2-Aug-2011",j="<h2>tDash.org</h2><p>A dashboard for Twitter.<br/></p><p><em>Ver "+aL+" | "+p+'</em></p><p>tDash is undergoing rapid development. Please give us your <a target="_blank" href="http://tdash.uservoice.com">feedback here</a>.</p><hr/><p>Copyright 2009-2010 tDash.org</p><p>Follow <a target="_blank" href="http://twitter.com/tdash">@tdash</a> for updates</p><hr/><p id="APILimit"></p>',aU='<h2>Keyboard shortcuts</h2><p>All shortcuts are case insensitive</p> <table cellspacing="0" id="helpKeyShorts"><tbody><tr><td class="helpKey">Space</td><td>Go to next tweet.<br/>Jumps to next folder if no more unread tweets in current folder</td></tr><tr><td><span class="helpKey">o</span></td><td>Open URL(s) in the selected tweet</td></tr>  <tr><td><span class="helpKey">n</span> or <span class="helpKey">j</span></td><td>Go to next tweet</td></tr><tr><td><span class="helpKey">p</span> or <span class="helpKey">k</span></td><td>Go to previous tweet</td></tr> <tr><td class="helpKey">u</td><td>Fetch new tweets (get Updates)</td></tr> <tr><td class="helpKey">s</td><td>Enter your status</td></tr> <tr><td class="helpKey">r</td><td>Reply to currently selected tweet</td></tr> <tr><td class="helpKey">f</td><td>Favourite the currently selected tweet</td></tr> <tr><td class="helpKey">t</td><td>ReTweet the currently selected tweet</td></tr> <tr><td class="helpKey">q</td><td>Quick RT the currently selected tweet</td></tr><tr><td class="helpKey">?</td><td>Show this help screen</td></tr> <tr><td class="helpKey">Esc</td><td>Close modal screens like this screen</td></tr></tbody></table>',aI=3600000,J="<table><tbody><tr>",aO='<td id="folderButtTd"><input id="markAllReadButton" type="button" value="Mark folder as read" onclick="dash.markAllRead();"/></td></tr></tbody></table>',at=false,o=false,aD={none:100,friend:0,folder:1,list:2,trends:3,tool:4,search:5},bf={100:"",0:"#navFriends",1:"#navFolders",2:"#navList",3:"#navTrends",4:"#navToolBox",5:"#navSearch"},x={100:ar,0:aP,1:ba,2:W,3:aK,4:ar,5:ar},aQ=/@([a-zA-Z0-9_]+)/gi,V=null,K=/http:\/\/([^\/]*)\/.*/,ap=/(ftp|http|https|file):\/\/[\S]+/gi;hashTagPattern=/( |^)#([\w]+)/gi;var f=aD.none;var D={mentions:{url:"https://api.twitter.com/1.1/statuses/mentions_timeline.json",name:"Mentions",converter:null},favs:{url:"https://api.twitter.com/1.1/favorites/list.json",name:"Favourites",converter:null}},aa=[],h=[],av=null,F=null,c=0,a6=0,Y=0,aX=0,ax=0,w=0,z={},ac=[],an=0,aV=null,a2=true;var bb=[],n={count:200},bd=getCurrTime();var aM={};var aW=[];function ar(){return false}function aT(){if(aV!=null){aV.cancel()}}function y(){window.focus();aT()}this.fetchOver=function(){if(!a2){var bj=Y+ax;if(bj>0){aT();var bi=[];if(Y>0){bi.push(Y+" from friends")}if(ax>0){bi.push(ax+" in folders")}aV=createMyNotification(bj+" new tweets",bi.join(", "));if(aV){aV.onclick=y}}}};$(window).focus(function(){a2=true;aT()}).blur(function(){a2=false;aT()});function R(bj,bi){if(!aM[bj.id_str]){bj.tdashRead=false;aM[bj.id_str]=bj;if(tweetReadStore.get&&(!bi)){if(tweetReadStore.get(bj.id_str)){ag(aM[bj.id_str])}}}}function aN(bk,bj){if(bj){for(var bi=bj.length;bi--;){if(bj[bi]==bk){return aM[bj[bi]]}}}return null}function aP(){var bk=null;for(var bi in z){var bj=z[bi];if(bj.tdashUnread>0){bk=bj;break}}if(bk){dash.navClick(bk.id);return true}return false}function W(){var bi=null;for(var bj in F.userLists){var bk=F.userLists[bj];if(bk.tdashUnread>0){bi=bk;break}}if(bi){dash.listClick(bi.id);return true}return false}function ba(){var bk=null;var bi=F.folderData;for(var bj in bi){if(bi[bj].unread>0){bk=bj;break}}if(bk){dash.folderClick(bk);return true}return false}function aK(){var bk=null;for(var bj in L){var bi=L[bj];if(!bi.tdashRead){bk=bj;break}}if(bk){dash.trendClick(bk);return true}return false}function ah(){if(F){if(F.userLists.length>0){$("#readerInfo").html('<p><input type="button" onClick="dash.markAllListRead();" value="Mark all lists as read" /></p>');$(readerObj).html("")}else{$("#readerInfo").html('<p>Apparently, you haven\'t subscribed to any lists. Lists are a great way to organise, prioritise your contacts.</p><p>You can find out more <a href="http://help.twitter.com/forums/10711-getting-started/entries/76460-twitter-lists" target="_blank">here</a></p>');$(readerObj).html("")}}resizeIframe()}this.markAllListRead=function(){if(aX>0){if(confirm("Are you sure you want to mark "+aX+" tweets from your Lists as read?")){var bi=F.userLists;for(var bk=bi.length;bk--;){var bl=F.twtsFrmLists[bi[bk].id];for(var bj=bl.length;bj--;){ag(aM[bl[bj]])}}S()}}};this.changeMode=function(bj,bk){var bi=(f!=bj);if(bi){$(bf[f]).hide();f=bj;$(bf[bj]).slideDown(200)}if(bk){if(bj==aD.friend){dash.navClick(0)}else{if(bj==aD.list){ah()}}}S()};function G(bi){return((bi>0)?" ("+bi+")":"")}function I(bi,bl){var bk=z[bi].screen_name,bj=z[bl].screen_name;return(bk<bj)?-1:((bk==bj)?0:1)}function S(){var bp="",bu="";$(".navSel").removeClass("navSel");if((f==aD.none)||(f==aD.friend)){for(var bq in ac){var bn=z[ac[bq]];if(bn.tdashUnread>0){bp+='<p onclick="dash.navClick('+bn.id+')" class="navElem '+(c==bn.id?"navSel":"")+'">'+bn.screen_name+" ("+bn.tdashUnread+")</p>"}else{bu+='<p onclick="dash.navClick('+bn.id+')" class="navElem navRead '+(c==bn.id?"navSel":"")+'">'+bn.screen_name+" </p>"}}if(bu.length>0){bu='<div id="moreFriends"><div id="moreButt" onclick="toggleMoreFriends()">'+(showMore?"Less":"More")+"</div><div"+(showMore?"":' style="display:none"')+' id="moreFrndContent">'+bu+"</div></div>"}$("#navFriends").html(bp+bu);$("#navList").empty();$("#navFolders").empty()}else{if(f==aD.list){if(F){for(var bq in F.userLists){var bs=F.userLists[bq];if(bs.tdashUnread>0){bp+='<p onclick="dash.listClick('+bs.id+')" class="navElem '+(c==bs.id?"navSel":"")+'">'+bs.slug+" ("+bs.tdashUnread+")</p>"}else{bu+='<p onclick="dash.listClick('+bs.id+')" class="navElem navRead '+(c==bs.id?"navSel":"")+'">'+bs.slug+" </p>"}}$("#navList").html(bp+bu)}}else{if(f==aD.folder){if(F){var bp="";for(var bk in D){var bj=D[bk];var bm=F.folderData[bk];if(bm.unread>0){bp+="<p onclick=\"dash.folderClick('"+bk+'\');" class="navElem '+(c==bk?"navSel":"")+'">'+bj.name+" ("+bm.unread+")</p>"}else{bp+="<p onclick=\"dash.folderClick('"+bk+'\');" class="navElem navRead '+(c==bk?"navSel":"")+'">'+bj.name+"</p>"}}$("#navFolders").html(bp)}}else{if(f==aD.trends){for(var bi in L){var br=L[bi];var bl=br.tdashRead?" navRead":"";bp+="<p onclick=\"dash.trendClick('"+bi+'\');" class="navElem'+bl+(c==bi?" navSel":"")+'">'+bi+"</p>"}$("#navTrends").html(bp)}else{if(f==aD.tool){var bo=F?G(F.cCache.length):"";bp+='<p onclick="dash.toolClick(\'clicks\');" class="navElem'+(c=="clicks"?" navSel":"")+'">Clicks '+bo+"</p>";$("#navToolBox").html(bp)}else{if(f==aD.search){var bt=F.savedSearches;if(bt){if(bt.length>0){for(var bq=bt.length;bq--;){bp+='<p onclick="dash.searchClick('+bq+');" class="navElem'+(c==(bq+1)?" navSel":"")+'">'+bt[bq].name+"</p>"}}else{bp+='<p class="navElem">No saved searches</p>'}}else{bp+='<p class="navElem">Loading your saved searches</p>'}$("#navSearchInner").html(bp)}}}}}}$("#navHeadFriends").html("Friends "+G(Y));$("#navHeadList").html("Lists "+G(aX));$("#navHeadFolders").html("Folders "+G(ax));$("#navHeadTrends").html("Trends "+G(w));document.title=G(Y+ax)+" tDash";resizeIframe()}function a1(){Y=0;z=[];ac=[];var bj=aW[currLogin].twtsFrmFrnds;for(var bi=bj.length;bi--;){var bk=aM[bj[bi]];if(!z[bk.user.id]){z[bk.user.id]=bk.user;z[bk.user.id].tdashUnread=0;ac.push(bk.user.id)}if(!bk.tdashRead){Y++;z[bk.user.id].tdashUnread++}}ac.sort(I);be()}function a7(bk,bj){var bi=' onclick="dash.regClick('+bj+');"';bk=bk.replace(ap,'<a data-tweetId="'+bj+'" href="$&" class="st_link" target="_blank"'+bi+">$&</a>").replace(aQ,'<a href="http://twitter.com/$1" target="_blank"'+bi+">$&</a>");return bk.replace(hashTagPattern,'$1<a target="_blank" href="http://twitter.com/search?q=%23$2">#$2</a>').replace(/\n/g,"<br/>")}function aG(bj,bl){var bk=Math.round((bl-bj)/60000);if(bk>60){var bi=Math.round(bk/60);if(bi>24){var bm=Math.round(bi/24);return(bm>1?bm+" days ago":"one day ago")}return(bi>1?bi+" hours ago":"one hour ago")}return((bk>0)?bk+" mins ago":"just now")}function X(bi){return bi.replace(/[\s]href=/i,' target="_blank" href=')}function ab(bm,bj){var bn=bj.length;var bl=0,bk=0,bi=bn;while(bl<bi){bk=Math.floor((bl+bi)/2);if(bj[bk]<bm){bl=bk+1}else{bi=bk}}if((bl<bn)&&(bj[bl]==bm)){return bl}else{return -1}}var ae=["307.to","adjix.com","b23.ru","bacn.me","bit.ly","bloat.me","budurl.com","cli.gs","clipurl.us","cort.as","digg.com","dwarfurl.com","fb.me","ff.im","fff.to","goo.gl","href.in","idek.net","is.gd","j.mp","kl.am","korta.nu","lin.cr","livesi.de","ln-s.net","loopt.us","lost.in","memurl.com","merky.de","migre.me","moourl.com","nanourl.se","om.ly","ow.ly","peaurl.com","ping.fm","piurl.com","plurl.me","pnt.me","poprl.com","post.ly","rde.me","reallytinyurl.com","redir.ec","retwt.me","rubyurl.com","short.ie","short.to","smallr.com","sn.im","sn.vc","snipr.com","snipurl.com","snurl.com","su.pr","tiny.cc","tinysong.com","tinyurl.com","togoto.us","tr.im","tra.kz","trg.li","twurl.cc","twurl.nl","u.mavrev.com","u.nu","ur1.ca","url.az","url.ie","urlx.ie","w34.us","xrl.us","yep.it","zi.ma","zurl.ws","chilp.it","notlong.com","qlnk.net","trim.li","url4.eu"];function bg(bi){return(ab(bi.toLowerCase(),myFollowers)>=0)}this.dmChosen=function(){var bi=$("#dmFollowerChoice").val();$.modal.close();this.dm(bi)};this.dm=function(bi){var bj='<div><h2><img style="vertical-align:middle;" src="/images/ink.png"/>Direct Message to '+bi+"</h2>";bj+='<form id="dmForm" method="post" action="https://api.twitter.com/1.1/direct_messages/new.xml" target="upload_target"><textarea name="text" rows="4" cols="40" id="dmInput" ></textarea>';bj+='<input id="dmScreenName" type="text" name="screen_name" value="'+bi+'" style="display:none;" />';bj+='<input type="text" id="dm_oauth_consumer_key" name="oauth_consumer_key" value="tDash" style="display:none;" />';bj+='<input type="text" id="dm_oauth_nonce" name="oauth_nonce" value="tDash" style="display:none;" />';bj+='<input type="text" id="dm_oauth_signature" name="oauth_signature" value="tDash" style="display:none;" />';bj+='<input type="text" id="dm_oauth_signature_method" name="oauth_signature_method" value="HMAC-SHA1" style="display:none;" />';bj+='<input type="text" id="dm_oauth_timestamp" name="oauth_timestamp" value="tDash" style="display:none;" />';bj+='<input type="text" id="dm_oauth_token" name="oauth_token" value="tDash" style="display:none;" />';bj+='<input type="text" id="dm_oauth_version" name="oauth_version" value="1.0" style="display:none;" /></form>';bj+='<p id="dmCharCount" class="charCount" >140</p><input type="button" id="dmButton" onclick="dash.dmClick()" value="&#9997; Send message"/>';$.modal(bj,{onShow:function(bk){$(bk.container).css("width","auto");$(bk.container).css("height","auto");at=true},onClose:function(bk){at=false;$.modal.close()}});$("#dmInput").keyup(B)};function Z(){$(this).find(".indTd").addClass("indHover")}function am(){$(this).find(".indTd").removeClass("indHover")}function aj(bi){$(".status").hover(Z,am);if(myFollowers){for(i in bi){var bk=bi[i];var bj=aM[bk].user.screen_name;if(bg(bj)){$("#stat"+bk+" .dmPlcHld").html('&nbsp;<span class="st_button" onclick="dash.dm(\''+bj+"')\">&#8618;&nbsp;DM</span>")}}}}function E(bj,bi,bl,bk){$("#stat"+bj+" .imgPreview").append('<li><a title="'+bk+' preview" target="_blank" class="linkNoDec" href="'+bi+'"><img class="linkNoDec" src="'+bl+'"></img></a></li>')}var m=[[/http:\/\/tweetphoto\.com\/([\S]+)/i,function(bi,bk,bj){dashOauth.getJSONP("http://tweetphotoapi.com/api/TPAPI.svc/jsonp/metadatafromurl",{url:bi,callback:"?"},bk,function(bl,bm){if(bl.ThumbnailUrl){E(bm,bi,bl.ThumbnailUrl,"TweetPhoto")}})}],[/http:\/\/vimeo\.com\/([0-9]+)/i,function(bi,bj,bk){dashOauth.getJSONP("http://vimeo.com/api/v2/video/"+bk+".json",{callback:"?"},bj,function(bl,bm){if(bl.length>0){if(bl[0].thumbnail_small){E(bm,bi,bl[0].thumbnail_small,"Vimeo")}}})}],[/http:\/\/twitpic\.com\/([\S]+)/i,function(bi,bk,bj){E(bk,bi,"http://twitpic.com/show/mini/"+bj,"Twitpic")}],[/http:\/\/tdash\.org\/x([\S]+)/i,function(bi,bk,bj){E(bk,bi,"http://tdash.org/pic/showThumb?id="+bj,"tDash")}],[/http:\/\/[w.]*flic\.kr\/p\/([\S]+)/i,function(bi,bk,bj){E(bk,bi,"http://flickr.com/p/img/"+bj+"_s.jpg","Flickr")}],[/http:\/\/[w.]*flickr.com\/photos\/[\S]+\/([0-9]+)/i,function(bi,bm,bl){var bo="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ";var bj=bo.length;var bn="";while(bl>=bj){var bp=bl/bj;var bk=(bl-(bj*Math.floor(bp)));bn=bo[bk]+bn;bl=Math.floor(bp)}if(bl>0){bn=bo[bl]+bn}E(bm,bi,"http://flickr.com/p/img/"+bn+"_s.jpg","Flickr")}],[/http:\/\/.*youtube.com\/.*[?&]v=([^&#]*)/i,function(bi,bj,bk){E(bj,bi,"http://img.youtube.com/vi/"+bk+"/2.jpg","YouTube")}],[/http:\/\/youtu.be\/([^&#?]*)/i,function(bi,bj,bk){E(bj,bi,"http://img.youtube.com/vi/"+bk+"/2.jpg","YouTube")}],[/http:\/\/yfrog\.com\/([\S]+)/i,function(bi,bk,bj){E(bk,bi,"http://yfrog.com/"+bj+".th.jpg","yFrog")}],[/http:\/\/metacafe\.com\/w[atch]*\/([0-9]+)\/.*/i,function(bi,bj,bk){E(bj,bi,"http://metacafe.com/thumb/"+bk+".jpg","MetaCafe")}],[/http:\/\/[w.]*dailymotion\.com\/video\/([^_]+).*/i,function(bi,bj,bk){E(bj,bi,"http://dailymotion.com/thumbnail/160x120/video/"+bk,"DailyMotion")}],[/http:\/\/pk\.gd\/(.*)/i,function(bj,bk,bi){E(bk,bj,"http://img.pikchur.com/pic_"+bi+"_t.jpg","Pikchur")}],[/http:\/\/mp\.gd\/(.*)/i,function(bi,bj,bk){E(bj,bi,"http://vid.pikchur.com/vid_"+bk+"_t.jpg","Pikchur Video")}],[/http:\/\/pikchur\.com\/(.*)/i,function(bi,bj,bk){if(bk.substring(0,2)==="v/"){E(bj,bi,"http://vid.pikchur.com/vid_"+bk.substring(2)+"_t.jpg","Pikchur Video")}else{E(bj,bi,"http://img.pikchur.com/pic_"+bk+"_t.jpg","Pikchur")}}],[/http:\/\/8tracks\.com\/[^\/]+\/(.*)/i,function(bi,bj,bk){dashOauth.getJSONP("http://8tracks.com/mixes.jsonp",{q:bk,callback:"?"},bj,function(bl,bn){if(bl.mixes){if(bl.mixes.length>0){var bm=bl.mixes[0].cover_urls.max133w;E(bn,bi,bm,"8Tracks Cover")}}})}],[/http:\/\/twitsnaps\.com\/([0-9]+)/i,function(bi,bk,bj){E(bk,bi,"http://twitsnaps.com/mini/"+bj,"Twitsnaps Image")}]];function au(bn,bm){var bl=$(bm);var bi=bl.attr("href");for(var bk=m.length;bk--;){var bj=m[bk][0].exec(bi);if(bj){m[bk][1](bi,bl.attr("data-tweetId"),bj[1])}}}function l(bk){var bj=$(this).attr("href");var bi=K.exec(bj);if(bi){if(ab(bi[1],ae)>=0){return true}}return false}function aY(br){var bl='<table class="stTbl centerAlignTbl">',bu=[],bn=getCurrTime(),bi=false;for(var bm in br){var bp=aM[br[bm]];if(bp){var bk="status";var bj="";var bq=bp.id_str?bp.id_str:bp.id;if(a6==bq){bk+=" selected";bj+=" indSel";bi=true}else{if(bp.tdashRead){bj+=" indRead"}}var bo=Date.parse(bp.created_at);var bs=bp.retweeted_status?'<span class="quickRTLabel">Quick RT @'+bp.retweeted_status.user.screen_name+"</span>&nbsp;"+bp.retweeted_status.text:bp.text;bk+=(bp.tdashRead?" read":" unread");bl+='<tr data-tweet-id="'+bq+'" id="stat'+bq+'" onclick="dash.clickStat(\''+bq+'\')" class="'+bk+'">';bl+='<td class="indTd'+bj+'"></td><td class="imgTd"><img class="prof_img" src="'+bp.user.profile_image_url+'" /></td>';bl+='<td><p class="text">'+a7(bs,bq)+"</p>";bl+='<p class="metaStatus"><span class="author" onclick="var event = arguments[0]||window.event;dash.showUserDtl(event,\''+bq+"');\">"+bp.user.screen_name+'</span><span class="dmPlcHld" ></span>';if(bp.tDashOrigId){bl+='&nbsp;<span class="createdAt" data-created-at="'+bo+'"> '+aG(bo,bn)+"</span>"}else{bl+='&nbsp;<a target="_blank" href="http://twitter.com/'+bp.user.screen_name+"/status/"+bq+'" class="createdAt" data-created-at="'+bo+'"> '+aG(bo,bn)+"</a>"}var bt=bp.in_reply_to_status_id_str;bl+="from "+X(bp.source);if(bt){bl+=' <a target="_blank" href="http://twitter.com/'+bp.in_reply_to_screen_name+"/status/"+bt+'">in reply to '+bp.in_reply_to_screen_name+"</a>"}else{if(bp.in_reply_to_screen_name){bl+=' <a target="_blank" href="http://twitter.com/'+bp.in_reply_to_screen_name+'">in reply to '+bp.in_reply_to_screen_name+"</a>"}}bl+='<ul class="imgPreview"></ul>';if(bt){bl+='<div class="replyTo replyTo'+bt+'">Fetching parent tweet</div>';bu.push(bt)}bl+='</td><td class="buttTd plcHld"></td>';bl+="</tr>"}}bl+="</table>";$(readerObj).html(bl);for(bm=bu.length;bm--;){if(bm>10){$(".replyTo"+bu[bm]).html('<span class="toolButt pointCursor" onclick="dash.fetchReplyTo('+bu[bm]+',4)">Get parent tweets</span></div></div>')}else{bh(bu[bm],1)}}if(br.length>0){t($("#stat"+(bi?a6:br[0])).first(),0);setTimeout(function(){$("a.st_link").each(au).filter(l).slice(0,100).addClass("xpanding").longUrl({complete:function(bv){this.removeClass("xpanding").addClass("xpanded")},callback:function(bw,bv){if(bv){this.attr("href",bv);if(bv.length<40){this.text(bv)}else{var bx=bv.slice(0,40)+"...";this.text(bx).attr("title",bv)}au(0,this.get(0))}}});aj(br)},0)}}function aS(bk,bl){var bi='<div class="replyToData">In reply to <em>'+bk.user.screen_name+"</em> &#8227; "+bk.text+"</div>";var bj=bk.in_reply_to_status_id_str;if(bj){bi+='<div class="replyTo replyTo'+bj+'"><div class="replyToData">';if(bl>0){bi+="Fetching parent tweet</div></div>"}else{bi+='<span class="toolButt pointCursor" onclick="dash.fetchReplyTo(\''+bj+"',4)\">Get more tweets</span></div></div>"}}$(".replyTo"+bk.id_str).html(bi);if(bj&&(bl>0)){if(aM[bj]){aS(aM[bj],bl)}else{bh(bj,bl-1)}}}this.fetchReplyTo=function(bj,bi){$(".replyTo"+bj).html('<div class="replyToData">Fetching parent tweet</div>');bh(bj,bi)};function a9(bj,bk){if(bj.id_str){R(bj);aS(bj,bk);for(var bi=bb.length;bi--;){if(bb[bi]==bj.id_str){bb.splice(bi,1);break}}}}function bh(bk,bj){if(aM[bk]){aS(aM[bk],bj)}else{for(var bi=bb.length;bi--;){if(bb[bi]==bk){return}}bb.push(bk);rQ.nQ(currLogin,false,"Reply to "+bk,"https://api.twitter.com/1.1/statuses/show.json",{id:bk},bj,a9)}}this.markAllRead=function(){if(f==aD.trends){for(id in L){aq(L[id])}}else{for(var bi in aa){var bj=aM[aa[bi]];ag(bj)}aY(aa)}S()};function u(){$(".status",readerObj).each(function(bi,bj){var bk=bj.getAttribute("data-tweet-id");var bl=aM[bk];if(bl){if(bl.tdashRead==true){if(bl.id_str!=a6){$("#stat"+bl.id_str).addClass("read")}}}})}this.navClick=function(bj){var bi=(c!=bj);if(bi){a6=0}c=bj;dash.changeMode(aD.friend);var bo=[];var br=F.twtsFrmFrnds;for(var bl=br.length;bl--;){var bq=aM[br[bl]];if((c==0)||(c==bq.user.id)){bo.push(bq.id_str)}}bo.reverse();var bm=J;if(c!=0){var bk=z[c];var bn=bk.name?bk.name:"";var bs=bk.location?bk.location:"";var bp=bk.description?bk.description:"";bm+='<td id="friendInfoTd"><b>'+bn+"</b><br/>"+bs+"</td>";bm+='<td id="friendDescrTd">'+bp+"</td>"}else{bm+='<td id="friendInfoTd">Showing tweets from all friends</td>'}bm+=aO;$("#readerInfo").html(bm);aZ(bo)};function aF(bm){a6=bm;var bi=$(".selected");bi.find(".plcHld").html("");bi.find(".indTd").removeClass("indSel").addClass("indRead");bi.removeClass("selected unread");var bj=$("#stat"+bm).addClass("selected");bj.find(".indTd").addClass("indSel");var bk=aM[bm];if(bk){ag(bk)}var bl='<table><tbody><tr><td class="buttWrap"><span class="st_button" onclick="dash.replyTo(\''+bm+"')\">&#9993;&nbsp;reply</span></td>";bl+='<td class="buttWrap"><span class="st_button" onclick="dash.retweet(\''+bm+"')\">&#8634;&nbsp;retweet</span></td>";bl+='<tr><td class="buttWrap"><span class="st_button" onclick="dash.fav(\''+bm+"')\">&#10084;&nbsp;fav</td>";bl+='<td class="buttWrap"><span class="st_button" onclick="dash.newRT(\''+bm+"')\">Quick RT</span></td>";$("#stat"+bm+" .plcHld").html(bl);u();S();t(bj,400)}function t(bj,bl){var bi=bj.prev();var bk=bi.length>0?bi:bj;if(bk.length>0){$(readerObj).scrollTo(bk,{duration:bl})}}this.replyTo=function(bk){var bj=aM[bk];if(bj){var bi="@"+bj.user.screen_name+" ";$("#replyToParam").val(bk);$("#replyInfo").html('<p style="font-size:80%;margin:0 1em;text-align:center">Replying to <b id="replyToUserName">'+bj.user.screen_name+'</b><br/><img title="'+bj.user.screen_name+'" class="prof_img" src="'+bj.user.profile_image_url+'"/></p>');$("#updateInput").val(bi).focus().setCursorPosition(bi.length);H(bi.length)}};function q(){$("#replyToParam").val(0);$("#replyInfo").empty()}this.retweet=function(bk){var bj=aM[bk];if(bj){var bi="RT @"+bj.user.screen_name+" "+bj.text;q();$("#updateInput").val(bi).focus().setCursorPosition(0);H(bi.length)}};this.fav=function(bj){var bi={action:"https://api.twitter.com/1.1/favorites/create/"+bj+".xml",method:"POST",parameters:{}};A(bi,"fav_");$("#favForm").attr("action",bi.action);ay("Marking as favourite");o="fav";$("#favForm").submit()};this.newRTAndDismiss=function(bi){$.modal.close();dash.newRT(bi)};this.newRT=function(bj){var bi={action:"https://api.twitter.com/1.1/statuses/retweet/"+bj+".xml",method:"POST",parameters:{}};A(bi,"rt_");$("#rtForm").attr("action",bi.action);ay("Retweeting");o="rt";$("#rtForm").submit()};this.favSubmitted=function(){ay("")};this.clickStat=aF;function ag(bk){if(!bk.tdashRead){bk.tdashRead=true;if(tweetReadStore.set){tweetReadStore.set(bk.id_str,Math.round(getCurrTime()/aI))}if(aN(bk.id_str,F.twtsFrmFrnds)){z[bk.user.id].tdashUnread--;Y--}for(i in F.userLists){var bj=F.userLists[i];if(aN(bk.id_str,F.twtsFrmLists[bj.id])){bj.tdashUnread--;aX--}}for(folderName in D){var bi=F.folderData[folderName];if(aN(bk.id_str,bi.tweets)){bi.unread--;ax--}}}}function a3(bo,bm,bi){var bp=[];if(bi){var bl=false;var bj=bo.length;for(var bk=0;bk<bj;bk++){var bn=bo[bk];if(bn!=null){if((!bl)&&(!aN(bn.id_str,bm))){bl=true}if(bl){bp.push(bn.id_str);R(bn)}}}bm.push.apply(bm,bp)}else{var bj=bo.length;for(var bk=0;bk<bj;bk++){var bn=bo[bk];if(bn!=null){if(!aN(bn.id_str,bm)){bp.push(bn.id_str);R(bn)}else{break}}}bm.unshift.apply(bm,bp)}return bp}function al(bk,bi,bj){var bl=bi?n:F.insrtFrndParams;bl.page=bk+1;rQ.nQ(currLogin,false,"Friends' timeline (depth "+bj+")","https://api.twitter.com/1.1/statuses/home_timeline.json",bl,currLogin,function(bn,bm){bd=getCurrTime();var bo=a3(bn,aW[bm].twtsFrmFrnds,bi);if(bo.length>0){if(!bi){bl.since_id=bn[0].id}a1()}if(bj>0){al(bk+1,true,bj-1)}})}function aR(bi){return aM[bi].tdashRead}function a(bi){return !(aM[bi].tdashRead)}function a5(bo){var bn=-1;var bk=false;if(a6!=0){for(var bj in aa){if(!aR(aa[bj])){bk=true}if(aa[bj]==a6){bn=parseInt(bj);break}}}if(bo&&(bn==-1)&&((f==aD.none)||(f==aD.trends)||(a6!=0))&&(!bk)){for(var bj in aD){var bm=aD[bj];var bl=x[bm];var bi=bl();if(bi){dash.changeMode(bm);break}}}else{aF(aa[bn+1])}}function aB(){var bj=aa.length;for(var bi in aa){if(aa[bi]==a6){bj=parseInt(bi);break}}aF(aa[bj-1])}function ak(bk,bi){var bj=140-bi;bk.text(bj).removeClass("alert warning error");if(bj<20){if(bj<10){if(bj<0){bk.addClass("error")}else{bk.addClass("warning")}}else{bk.addClass("alert")}}}function r(){if($("#replyToParam").val()!=0){var bj=$("#updateInput").val();var bi="@"+$("#replyToUserName").text();if((bj==bi)||(bj.indexOf(bi+" ")==0)){return false}}else{return false}return true}function H(bi){if(bi==0||r()){q()}if(av==null){av=$("#updateCharCount")}ak(av,bi)}function k(bi){H(bi.target.value.length);a4(bi)}function B(bi){ak($("#dmCharCount"),bi.target.value.length)}function a4(bi){if(bi.cancelBubble){bi.cancelBubble=true}if(bi.stopPropagation){bi.stopPropagation()}}function C(bl){if(bl.altKey||bl.ctrlKey){return}var bm=String.fromCharCode(bl.which);if((bl.target.id!="updateInput")&&(bl.target.id!="searchInput")){if(!at){switch(bm){case" ":a4(bl);a5(true);return false;break;case"j":case"J":case"n":case"N":case" ":a5();a4(bl);break;case"k":case"K":case"p":case"P":aB();a4(bl);break;case"s":case"S":a4(bl);$("#updateInput").focus();break;case"r":case"R":var bk=$(".selected").attr("data-tweet-id");if(bk){a4(bl);dash.replyTo(bk)}break;case"f":case"F":var bk=$(".selected").attr("data-tweet-id");if(bk){dash.fav(bk);a4(bl)}break;case"t":case"T":var bk=$(".selected").attr("data-tweet-id");if(bk){dash.retweet(bk);a4(bl)}break;case"q":case"Q":var bk=$(".selected").attr("data-tweet-id");if(bk){$.modal('<p>Are you sure you want to retweet the selected tweet?</p><p><input type="button" value="Yes" onClick="dash.newRTAndDismiss(\''+bk+"')\"/></p>");a4(bl)}break;case"u":case"U":a4(bl);dash.fetchNew();break;case"o":case"O":a4(bl);var bi=$(".selected .text a");if(bi.length>1){var bj="<table><tbody>";V=bi.map(function(bn){return $(this).attr("href")}).get();for(i in V){bj+='<tr><td class="urlNumTd">'+i+'</td><td><a target="_blank" href="'+V[i]+'">'+V[i]+"</a></td></tr>"}bj+="</tbody></table><p>Press [Esc] to close this message</p>";at=true;$.modal("<p>Multiple links found. Press a number to open the URL.</p>"+bj,{onClose:function(bn){at=false;V=null;$.modal.close()}})}else{if(bi.length==1){dash.regClick($(".selected").attr("data-tweet-id"));window.open(bi.attr("href"))}else{if(a6!=0){$.modal("<p>No links found!</p><p>Press [Esc] to close this message</p>")}else{$.modal("<p>To open a URL please select the Tweet first!</p><p>Press [Esc] to close this message</p>")}}}break;case"?":M("keys");a4(bl);break}}else{if(V){if(bm>="0"&&bm<="9"){dash.regClick($(".selected").attr("data-tweet-id"));window.open(V[bm])}}}}return true}function af(bi){var bk=0;for(var bj=bi.length;bj--;){if(!aR(bi[bj])){bk+=1}}return bk}function O(){for(var bi in F.userLists){var bj=F.userLists[bi];var bk={per_page:200,list_id:bj.id};if(F.latestFromList[bi]){bk.since_id=F.latestFromList[bi]}rQ.nQ(currLogin,false,"List "+bj.name,"https://api.twitter.com/1.1/lists/statuses.json",bk,{index:bi,login:currLogin},function(bm,bo){var bl=aW[bo.login];var bn=bl.userLists[bo.index];if(!bl.twtsFrmLists[bn.id]){bl.twtsFrmLists[bn.id]=[]}var bq=a3(bm,bl.twtsFrmLists[bn.id],false);if(bq.length>0){bl.latestFromList[bo.index]=bq[0];var bp=af(bq);bn.tdashUnread+=bp;if(bo.login==currLogin){aX+=bp;S();if((f==aD.list)&&(c==bn.id)){be()}}}})}}function a0(bi){var bk=[];for(i in bi){var bj=bi[i];var bl={user:bj.recipient,favorited:false,in_reply_to_user_id:null,in_reply_to_screen_name:null,in_reply_to_status_id:null,source:"web",id_str:"dm"+bj.id_str,text:bj.text,created_at:bj.created_at,tDashOrigId:bj.id_str};bk.push(bl)}return bk}function aw(bi){var bk=[];for(i in bi){var bj=bi[i];var bl={user:bj.sender,favorited:false,in_reply_to_user_id:null,in_reply_to_screen_name:null,in_reply_to_status_id:null,source:"web",id_str:"dm"+bj.id_str,text:bj.text,created_at:bj.created_at,tDashOrigId:bj.id_str};bk.push(bl)}return bk}function ai(){for(var bk in D){var bi=D[bk];var bj=aW[currLogin].folderData[bk];rQ.nQ(currLogin,false,bi.name,bi.url,bj.options,{login:currLogin,name:bk},function(bl,bn){var bo=aW[bn.login].folderData[bn.name];var bp=D[bn.name];var bm;if(bp.converter){bm=bp.converter(bl)}else{bm=bl}var br=a3(bm,bo.tweets,false);if(br.length>0){bo.options.since_id=bm[0].tDashOrigId?bm[0].tDashOrigId:bm[0].id_str;var bq=$.grep(br,a).length;bo.unread+=bq;if(bn.login==currLogin){ax+=bq;S();if((f==aD.folder)&&(c==bn.name)){be()}}}})}}this.fetchNew=function(bi){bi=bi|0;al(0,false,bi);O();ai();aH()};function ay(bi){$("#statusBar #submitStatus").text(bi);resizeIframe()}function P(bk,bm){var bj=aW[bm],bi=bk;for(i in bi){var bl=bi[i];bl.tdashUnread=0;if(!bj.twtsFrmLists[bl.id]){bj.twtsFrmLists[bl.id]=[]}}bj.userLists.push.apply(bj.userLists,bi);if(currLogin==bm){S();be()}}function az(bi){rQ.nQ(bi,true,"Lists followed","https://api.twitter.com/1.1/lists/list.json",{},bi,function(bk,bj){aW[bj].listFetchEnded=true;P(bk,bj);if(bj==currLogin){dash.fetchNew(2)}})}function aZ(bk,bn){var bl=[];var bi=bn|$("#showReadButton").get(0).checked;for(var bj=bk.length;bj--;){var bm=aM[bk[bj]];if(bi||(bm.tdashRead==false)||(a6==bm.id_str)){bl.push(bm.id_str)}}if($("#sortOrderSelect").val()=="newTop"){bl.reverse()}aa=bl.slice();if(bl.length>0){aY(bl)}else{if(bk.length>0){$(readerObj).html('<p class="quickRTLabel" style="padding:2em;margin:2em;font-size:100%;text-align:center">There are <b>'+bk.length+'</b> tweets in this folder. To see them tick the "Show Read" checkbox above.</p>')}else{$(readerObj).html('<p class="quickRTLabel" style="padding:2em;margin:2em;font-size:100%;text-align:center">Either this folder is empty or the tweets are still being fetched.</p>')}}S()}function be(){if(f==aD.friend){dash.navClick(c)}else{if(f==aD.list){dash.listClick(c)}else{if(f==aD.folder){dash.folderClick(c)}else{if(f==aD.trends){aZ(h)}else{if(f==aD.tool){dash.toolClick(c)}else{if(f==aD.search){aZ(h)}else{var bj=(ax+Y+aX+w);var bi=bj>500?'<hr/><p style="padding:2em;">You have <b>'+bj+'</b> unread tweets.<br/><span class="quickRTLabel pointCursor" onclick="dash.powerSelect(\'sync\')">Click here</span> to mark all tweets as read until a recent date</p>':"";$("#readerInfo").html('<div class="initScreen"><p>Welcome to your dashboard!</p>Click on a menu on the left to get started!</p><p>You can also press the SPACEBAR to jump to the next unread tweet or folder!</p>'+bi);resizeIframe()}}}}}}}function aE(bi){for(i in F.userLists){if(F.userLists[i].id==bi){return F.userLists[i]}}return null}this.listClick=function(bi){c=bi;dash.changeMode(aD.list);var bj=aE(bi);var bk=J;if(bj){bk+='<td id="listInfoId"><a target="_blank" href="http://twitter.com'+bj.uri+'"><b>'+bj.full_name+"</b></a></td>";bk+='<td id="listDescr">'+bj.description+"</td>";bk+=aO;$("#readerInfo").html(bk);aZ(F.twtsFrmLists[bi])}else{ah()}};this.folderClick=function(bi){c=bi;dash.changeMode(aD.folder);var bj=D[bi];if(bj){var bk=J;bk+='<td id="listInfoId"><b>'+bj.name+"</b></td>";bk+=aO;$("#readerInfo").html(bk);aZ(F.folderData[bi].tweets)}};function Q(bj,bi){if(!aW[bj]){aW[bj]={credResp:bi,twtsFrmFrnds:[],insrtFrndParams:{count:200},listFetchEnded:false,userLists:[],latestFromList:[],twtsFrmLists:{},cCache:[],folderData:{mentions:{unread:0,options:{count:200},tweets:[]},inbox:{unread:0,options:{count:200},tweets:[]},outbox:{unread:0,options:{count:200},tweets:[]},favs:{unread:0,options:{},tweets:[]},},savedSearches:null};return true}else{return false}}function aA(){aX=0;var bi=F.userLists;for(var bj=bi.length;bj--;){aX+=af(F.twtsFrmLists[bi[bj].id])}ax=0;for(bj in F.folderData){ax+=F.folderData[bj].unread}$("#sortOrderSelect").val(settings[currLogin].oldOnTop?"oldTop":"newTop");a1()}this.userSelectChange=function(){var bi=$("#logSelect").val();if(bi>=0){currLogin=bi;this.showUser(currLogin)}else{window.location="/oauth/login?addNewConfirm=true"}};var d=getCurrTime();function v(bj,bk,bi){bk.firstChild.nodeValue=aG(parseInt(bk.getAttribute("data-created-at")),d)}this.selfUpdater=function(){d=getCurrTime();$(".createdAt").each(v);if((d-bd)>($("#autoFetchSelect").val()*60*1000)){dash.fetchNew()}setTimeout("dash.selfUpdater();",60000)};var N="";var ad=0;var a8=0;var s="";function A(bi,bj){OAuth.completeRequest(bi,oauthAccessor[currLogin]);OAuth.SignatureMethod.sign(bi,oauthAccessor[currLogin]);$("#"+bj+"oauth_consumer_key").val(bi.parameters.oauth_consumer_key);$("#"+bj+"oauth_nonce").val(bi.parameters.oauth_nonce);$("#"+bj+"oauth_signature").val(bi.parameters.oauth_signature);$("#"+bj+"oauth_timestamp").val(bi.parameters.oauth_timestamp);$("#"+bj+"oauth_token").val(bi.parameters.oauth_token)}function e(){var bj=$("#updateInput").val().replace(/\n/g,"\r\n");var bi={action:"https://api.twitter.com/1.1/statuses/update.xml",method:"POST",parameters:{status:bj,in_reply_to_status_id:$("#replyToParam").val(),source:"tDash"}};A(bi,"upd_");ay("Submitting status");o="update";$("#updateForm").submit()}this.statusSubmitted=function(){var bi=document.getElementById("upload_target");if(o){if(o=="update"){$("#updateInput").val("");H(0);al(0,false,0)}else{if((o=="dm")||(o=="fav")){ai()}else{if(o=="rt"){al(0,false,0)}}}o=false;bi.src="/empty.html";ay("Submitted successfully");$(readerObj).focus()}};this.dmClick=function(){dmVal=$("#dmInput").val();var bi=140-dmVal.length;if(bi<0){alert("Too many chars in DM. Max is 140. Auto URL shortening for DMs is not yet implemented.")}else{var bj={action:"https://api.twitter.com/1.1/direct_messages/new.xml",method:"POST",parameters:{text:dmVal,screen_name:$("#dmScreenName").val()}};A(bj,"dm_");ay("Sending direct message");o="dm";$("#dmForm").submit();$.modal.close()}};this.updateClick=function(){s=$("#updateInput").val();var bj=140-s.length;if(bj<0){ad=s.search(ap);if(ad>=0){var bi=s.slice(ad,s.length);a8=bi.search(/[\s]/);a8=a8<0?bi.length:a8;N=bi.slice(0,a8);ay("Shortening URL; url");BitlyClient.shorten(N,"dash.shortenResponse")}else{alert("Too many chars in update. Max is 140");return}}else{e()}};this.shortenResponse=function(bi){ay("recvd response");if(bi.errorCode==0){var bl=bi.results[N];if(bl){var bj=bl.shortUrl;var bk=(s.length-a8+bj.length);if(bk<=140){$("#updateInput").val(s.slice(0,ad)+bj+s.slice(ad+a8,s.length));e();return}else{alert("After URL shortening, length of tweet is "+bk+" which is greater than 140 chars");return}}}alert("Couldn't shorten URL successfully")};function g(){var bi='<div><h2><img style="vertical-align:middle;" src="/images/ink.png"/>Direct Message</h2>';if(myFollowers){bi+="<p>In Twitter, you can send a DM only to someone who follows you.</p>";bi+="<p>Please select one from your list of followers:</p>";bi+='<select id="dmFollowerChoice">';for(i in myFollowers){bi+='<option value="'+myFollowers[i]+'">'+myFollowers[i]+"</option>"}bi+="</select>"}bi+='<input type="button" onclick="dash.dmChosen();" value="&#9997; DM selected user"/>';$.modal(bi)}function aC(bi){$(bi.container).css("height","auto")}this.imgUpload=function(){var bi="";if(currLogin>=0){bi="&loginId="+loginMap[currLogin]}$.modal('<iframe src="/pic/uploadStart?embed=true'+bi+'" style="width:650px;height:450px;border:none;"/>',{onShow:aC})};function M(bl){switch(bl){case"settings":$("#settings").modal();break;case"signOut":$.modal('<div><h2>Well, so long...</h2><a href="/oauth/logout">Sign Out?</a></div>');break;case"themeSelect":$.modal('<iframe src="/oauth/chooseTheme?embed=true" style="width:650px;height:450px;border:none;"/>',{opacity:0,onShow:aC});break;case"dm":g();break;case"keys":$.modal(aU);break;case"about":$.modal(j,{onShow:aC});dashOauth.oauthGetJSONP("https://api.twitter.com/1.1/account/rate_limit_status.json",{},oauthAccessor[currLogin],null,function(bn,bo){$("#APILimit").html("Twitter API call hourly limit: "+bn.hourly_limit+"<br/>Remaining quota for this hour:"+bn.remaining_hits)});break;case"feedback":UserVoice.Popin.show(uservoiceOptions);break;case"picView":if(F&&F.credResp){window.open("http://tdash.org/pic/user/"+F.credResp.screen_name)}else{$.modal('<p>You need to be <a href="/oauth/login">logged in</a>!</p>')}break;case"purge":var bi=deleteOld(tweetReadStore,true);var bj=deleteOld(trendReadStore,true);$.modal("<h1>Purging old DB content</h1><h2>Just a placeholder right now</h2><p>Backend type:"+Persist.type+"</p><p>Old tweet info: "+bi[0]+"/"+bi[1]+"</p><p>Old trend info:"+bj[0]+"</p>");break;case"sync":var bk=$("<script/>").attr("src","/scripts/jquery.date_input.js").appendTo("head");var bm=setInterval(function(){if(window.DateInput!==undefined){clearInterval(bm);bk.remove();aJ()}},200);break;case"enableNotifications":if(window.webkitNotifications){if(window.webkitNotifications.checkPermission()==0){$.modal("<p>Notifications are already enabled!</p>")}else{window.webkitNotifications.requestPermission()}}else{$.modal("<p>Sorry, your browser doesn't support notifications! Try using a recent version of Google-Chrome!</p>")}break;default:$.modal("<p>A glitch in the matrix! You probably need to reload the website. Try clearing the caches if needed.</p>");break}}function aJ(){var bi='<div id="syncDlg"><h2>Sync (beta)</h2><p>Please select a date to which the display should be synced to.</p><p>All tweets on or before this date will be marked as read</p><input id="max_date_input" type="text" name="date" class="date_input"/><input id="syncButton" type="button" value="Sync"/></div>';$.modal(bi,{onShow:function(bj){var bk=$("#max_date_input").date_input({maxDate:new Date()})[0];$(bj.container).css("width","auto");$(bj.container).css("height","auto");$("#syncButton").click(function(){var bn=bk.selectedDate;var bm=0;var bl=function(bp,bo){if(!bo.tdashRead){if(new Date(bo.created_at)<=bn){ag(bo);bm+=1}}};$.each(aM,bl);$("#syncDlg").html("<h2>Done!</h2><p>"+bm+" tweets were marked as read.</p><p>Press [Esc] to close</p>");S();be()});$(window).resize()}})}this.powerSelect=function(bj){var bi=bj?bj:$("#powerSelect").val();$("#powerSelect").val("more");M(bi)};this.showHelp=function(){$.modal('<iframe src="/help.html" style="width:700px;height:500px;"/>')};this.finishUpload=function(bi,bj){if(bi){$.modal.close();$.modal('<h1>Success</h1><p>Your new pic has been posted to Twitter.</p><p>The direct link is <a target="_blank" href="'+bj+'">here</a></p>')}else{$.modal.close();$.modal("<h1>Fail</h1>")}};this.showUserDtl=function(bl,bj){a4(bl);var bi=aM[bj].user;var bk='<img alt="profile" src="'+bi.profile_image_url+'" /><h1>'+bi.screen_name+"</h1>";bk+='<p><a target="_blank" href="http://twitter.com/'+bi.screen_name+'">Twitter profile page</a></p>';bk+="<p><b>"+bi.name+"</b></p>";bk+="<p><em>"+bi.description+"</em></p>";bk+="<p>Location: <b>"+bi.location+"</b></p>";bk+="<p>Friends: <b>"+bi.friends_count+"</b></p>";bk+="<p>Followers: <b>"+bi.followers_count+"</b></p>";$.modal(bk)};function b(bi){rQ.nQ(bi,true,"Saved searches","https://api.twitter.com/1.1/saved_searches/list.json",{},bi,function(bk,bj){aW[bj].savedSearches=bk})}this.showUser=function(bk,bj){var bi=Q(bk,bj);if(bk==currLogin){F=aW[currLogin];myFollowers=followers[currLogin]}var bl=bj?bj:F.credResp;an+=1;if(bi){$("#logSelect").append('<option value="'+bk+'">'+bl.screen_name+"</option>");if(an==1){$("#logSelect").prepend('<option value="-1">Add an account</option>').val(bk)}az(bk);b(bk)}if(bk==currLogin){ay("");c=0;a6=0;dash.changeMode(aD.none);aa=[];$(readerObj).empty();$("#view").show();$("#logInfo").html('<img style="padding:.2em .4em .2em 0;vertical-align:middle" class="prof_img" src="'+bl.profile_image_url+'"/><span class="name">'+bl.name+"</span>");aA();S();if(F.listFetchEnded){dash.fetchNew()}}};this.startRoll=function(){$("#versionStatus").text("tDash v"+aL);$("#readerInfo").html('<div class="initScreen"><p>Authenticating. If nothing happens for a long time <span id="showAuthTip">click here</span></p></div><div style="display:none;" id="authFailTip">If you are not able to authenticate, <ul><li><a href="http://twitter.com">Twitter</a> could be overloaded or inaccessible. Try browsing to it.</li><li>You might not have signed in yet! <a href="/oauth/login">Click here</a> to sign in.</li><li>You might be using an old version of tDash. Follow <a href="http://twitter.com/tdash">@tdash</a> to know about important updates.</li><li>You might have revoked permission to tDash.org from your Twitter control panel. <a href="http://twitter.com/settings/connections" target="_blank">Click here</a> to check it.<br/>If so, you will have to sign in again.</li></ul>');$("#showAuthTip").click(function(){$("#authFailTip").show()});$("#showReadButton").change(be);resizeIframe();var bi=false;if(oauthAccessor&&oauthAccessor.length>0){$("#updateInput").keyup(k);$(document).keypress(C);for(i in oauthAccessor){rQ.nQ(i,true,"Authentication","https://api.twitter.com/1.1/account/verify_credentials.json",{},i,function(bj,bk){if(bj.screen_name){if(currLogin<0){$("#readerInfo").html("Authentication successful. Please wait...");currLogin=bk}dash.showUser(bk,bj)}})}}else{bi=true}if(bi){$.modal('<div style="text-align:center" id="alert"><p>Welcome to <b><a class="linkNoDec" href="/"><img class="linkNoDec" alt="tDash" style="vertical-align:middle;padding:0 10px;" src="/images/logoColorSmall.png"/></a></b> a browser based client for Twitter.</p><hr/><p><img src="/images/user_warning_48.png" /></p><p>You are not authenticated!<br/><span class="noAuthTip">(Cookies need to be enabled for authentication)</span></p><p>Would you like to <a href="/oauth/login">Sign in</a>?<br/><span class="noAuthTip">oAuth is used for signing in with Twitter.<br/>No registration is required!</span></p></div>',{onShow:function(bj){$(bj.container).css("width","auto");$(bj.container).css("height","auto")}})}else{this.selfUpdater()}};var L={};var bc={};var T={};this.trendRead=function(bi){T[bi]=true;if(trendReadStore.set){trendReadStore.set(bi,Math.round(getCurrTime()/aI))}$("#trendReadBtn").hide()};function aq(bi){if(!bi.tdashRead){bc[bi.name]=true;bi.tdashRead=true;w--;return true}return false}this.regClick=function(bi){if(!aN(bi,F.cCache)){F.cCache.unshift(bi);S()}};this.toolClick=function(bi){switch(bi){case"clicks":c=bi;dash.changeMode(aD.tool);aa=F.cCache;$("#readerInfo").html('Your recent URL clicks, showing most recent on top! How is this useful? Click <a href="http://blog.tdash.org/our-new-feature-click-history" target="_blank">here</a> to know more.');aY(F.cCache);break}};this.trendClick=function(bk){c=bk;dash.changeMode(aD.trends);if(bk!=0){var bj=L[bk];if(bj){aa=[];var bi="";var bl=aq(bj);S();bi+='<div id="trendData">';bi+="<h2>"+bj.name+"</h2>";bi+='<p id="trendDescr">'+bj.description.text+"</p>";bi+='<p>[<a href="http://whatthetrend.com/trend/'+escape(bj.query)+'" target="_blank">Edit description</a>]';if(trendReadStore.set&&bl){bi+='&nbsp;<b id="trendReadBtn" class="st_button" onclick="dash.trendRead(\''+bj.name+"');\">Permanently mark Trend as Read</b>"}bi+='&nbsp;<a id="wttAttrib" target="_blank" href="http://api.whatthetrend.com/">Data by What the Trend?</a></p>';bi+="</div>";$("#readerInfo").html(bi);$(readerObj).html('<div id="searchResults">Searching tweets for this trend...</div>');$.getJSON("https://search.twitter.com/search.json?q="+escape(bj.query)+"&show_user=true&result_type=recent&rpp=100&callback=?",{},function(bm){if((f==aD.trends)&&bm.results){U(bm.results)}})}}};function U(bl){aa=[];var bi=[];for(var bj=bl.length;bj--;){var bk=bl[bj];bk.user={id:bk.from_user_id,profile_image_url:bk.profile_image_url,screen_name:bk.from_user};bk.source=bk.source.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"');bk.in_reply_to_screen_name=bk.to_user;R(bk);bi.unshift(bk.id_str)}h=bi;aZ(bi)}function ao(bj,bk){h=[];var bi="";S();bi+='<div id="trendData">';bi+="<h2>"+bj+"</h2>";bi+='<p id="trendDescr">Please wait</p>';bi+="</div>";$("#readerInfo").html(bi);$(readerObj).html('<div id="searchResults">Searching tweets for this query...</div>');$.getJSON("https://search.twitter.com/search.json?q="+escape(bk)+"&show_user=true&result_type=recent&rpp=100&callback=?",{},function(bl){if((f==aD.search)&&bl.results){$("#trendDescr").html("Found "+bl.results.length+" results.");U(bl.results)}})}this.searchClick=function(bi){c=bi+1;dash.changeMode(aD.search);var bj=F.savedSearches[bi];ao(bj.name,bj.query)};this.timeOrderChange=function(){var bi=$("#sortOrderSelect").val()=="oldTop";if(currLogin>=0){if(settings[currLogin].oldOnTop!=bi){settings[currLogin].oldOnTop=bi;$.post("/oauth/settingTimeOrder?value="+bi+"&loginId="+loginMap[currLogin])}be()}};function aH(){$.getJSON("http://api.whatthetrend.com/api/v2/trends.json?callback=?",{},function(bi){w=0;L={};for(i in bi.trends){var bj=bi.trends[i];if(T[bj.name]||bc[bj.name]){bj.tdashRead=true;bc[bj.name]=true}L[bj.name]=bj;if(!bj.tdashRead){w++;if(trendReadStore.get){if(trendReadStore.get(bj.name)){T[bj.name]=true;L[bj.name].tdashRead=true;w--}}}}S()})}this.searchKeyPress=function(bj){if(bj.altKey||bj.ctrlKey){return}if(bj.which==13){$(readerObj).focus();var bi=$("#searchInput").val();ao(bi,bi)}}};var bufferHeight=0;function resizeIframe(){readerObj.style.height="0px";var a=$(window).height();var b=10;$(".paddedLeftTd").each(function(){b+=$(this).outerHeight(true)});if(a<b){a=b}var c=$(readerObj).offset();a-=(c.top+$("#statusBar").outerHeight(true)+bufferHeight);a=(a<0)?0:a;readerObj.style.height=a+"px"}var dashOauth=new function(){var c=0;function b(e,g,j,d,m){var k="ojsonp"+c++;var h=$.extend({},g);h.callback=k;var l={action:e,method:"GET",parameters:h};OAuth.completeRequest(l,j);OAuth.SignatureMethod.sign(l,j);var f=e+"?"+OAuth.formEncode(l.parameters);a(k,f,d,m)}function a(d,f,h,j){var g=document.getElementsByTagName("head")[0];var e=document.createElement("script");window[d]=function(k){j(k,h);window[d]=undefined;try{delete window[d]}catch(l){}if(g){g.removeChild(e)}};e.src=f;g.appendChild(e)}this.getJSONP=function(g,f,k,h){var d="njsonp"+c++;var l=$.extend({},f);var j=false;$.each(l,function(m,n){j=true;if(n=="?"){l[m]=d;return false}});var e=(j)?"?"+$.param(l):"";a(d,g+e,k,h)};this.oauthGetJSONP=function(e,h,d,g,f){b(e,h,d,g,f)}};var tweetReadStore=null;var trendReadStore=null;function deleteOld(b,d){if(b.iterate){var a=(getCurrTime()/3600000);var g=a-15*24;var f=[];var e=0;b.iterate(function(h,j){e++;if(parseFloat(j)<g){f.push(h)}});if(!d){for(var c=f.length;c--;){b.remove(f[c])}}return[f.length,e]}}$(document).ready(function(){readerObj=document.getElementById("reader");window.onresize=resizeIframe;$("body").append('<iframe style="display:none" id="upload_target" name="upload_target" onload="dash.statusSubmitted()"></iframe>');Persist.remove("cookie");tweetReadStore=new Persist.Store("tDash",{domain:"tdash.org"});trendReadStore=new Persist.Store("tDashTrend",{domain:"tdash.org"});$("#searchInput").keyup(dash.searchKeyPress);dash.startRoll()});